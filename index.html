<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Job CRM</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-current: #EFF6FF; 
            --surface: #FFFFFF;
            --border: rgba(0,0,0,0.08);
            --accent-black: #111827;
            --text-main: #1F2937;
            --text-sub: #6B7280;
            --blue-600: #2563EB; --blue-text: #1E40AF;
            --orange-500: #F97316; --orange-text: #9A3412;
            --green-600: #16A34A; --green-text: #166534;
            --red-500: #EF4444; --red-text: #991B1B;
            --nav-slider-bg: rgba(37, 99, 235, 0.2); 
            --nav-active-text: #1E40AF;             
            --shadow-float: 0 20px 25px -5px rgb(0 0 0 / 0.1), 0 8px 10px -6px rgb(0 0 0 / 0.1);
        }
        * { box-sizing: border-box; outline: none; margin: 0; padding: 0; }
        body { font-family: 'Inter', sans-serif; background-color: var(--bg-current); color: var(--text-main); height: 100vh; display: flex; flex-direction: column; overflow: hidden; padding-top: 100px; transition: background-color 0.5s ease; }
        .nav-container { position: fixed; top: 30px; left: 50%; transform: translateX(-50%); z-index: 1000; display: flex; justify-content: center; }
        .pill-nav { position: relative; background: rgba(255, 255, 255, 0.9); backdrop-filter: blur(12px); padding: 6px; border-radius: 99px; display: flex; gap: 0; box-shadow: var(--shadow-float); border: 1px solid rgba(255,255,255,0.5); }
        .pill-slider { position: absolute; top: 6px; left: 6px; bottom: 6px; background-color: var(--nav-slider-bg); border-radius: 99px; transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); z-index: 1; }
        .nav-item { position: relative; z-index: 2; background: transparent; border: none; padding: 12px 28px; font-size: 1rem; font-weight: 600; color: var(--text-sub); cursor: pointer; transition: color 0.3s; border-radius: 99px; display: flex; align-items: center; gap: 8px; white-space: nowrap; }
        .nav-item:hover { color: var(--accent-black); }
        .nav-item.active { color: var(--nav-active-text); } 
        .badge { font-size: 0.75rem; background: rgba(0,0,0,0.05); color: var(--text-sub); padding: 2px 8px; border-radius: 12px; transition: all 0.3s; }
        .nav-item.active .badge { background: rgba(255,255,255,0.5); color: var(--nav-active-text); }
        .top-controls { position: fixed; top: 45px; right: 40px; z-index: 900; display: flex; align-items: center; gap: 10px; background: rgba(255,255,255,0.8); padding: 8px 12px; border-radius: 12px; backdrop-filter: blur(4px); box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05); }
        .view-label { font-size: 0.8rem; font-weight: 600; color: var(--text-sub); margin-right: 5px; }
        .toggle-switch { position: relative; width: 100px; height: 32px; background: #E5E7EB; border-radius: 99px; display: flex; align-items: center; cursor: pointer; padding: 2px; }
        .toggle-slider { position: absolute; left: 2px; width: 48px; height: 28px; background: #fff; border-radius: 99px; transition: transform 0.2s; box-shadow: 0 1px 3px rgba(0,0,0,0.1); }
        .toggle-option { flex: 1; text-align: center; font-size: 0.75rem; font-weight: 600; z-index: 2; color: var(--text-sub); user-select: none; }
        .toggle-switch.date-mode .toggle-slider { transform: translateX(48px); }
        .toggle-switch.date-mode .opt-date { color: var(--accent-black); }
        .toggle-switch:not(.date-mode) .opt-month { color: var(--accent-black); }
        main { flex: 1; padding: 20px 40px; overflow-y: auto; max-width: 1400px; margin: 0 auto; width: 100%; }
        .input-area { display: flex; flex-direction: column; align-items: center; margin-bottom: 40px; position: relative; }
        .add-box { display: flex; background: var(--surface); border: 1px solid var(--border); border-radius: 16px; padding: 6px; width: 600px; box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.05); transition: transform 0.2s, box-shadow 0.2s; }
        .add-box:focus-within { transform: translateY(-2px); box-shadow: 0 10px 15px -3px rgb(0 0 0 / 0.1); border-color: #2563EB; }
        input#urlInput { border: none; background: transparent; flex: 1; padding: 0 20px; font-size: 1rem; color: var(--text-main); }
        button#addBtn { background: var(--accent-black); color: #fff; border: none; padding: 12px 28px; border-radius: 12px; font-weight: 600; cursor: pointer; transition: opacity 0.2s; }
        button#addBtn:hover { opacity: 0.9; }
        
        /* Inject Button */
        button#injectBtn { background: #FFFBEB; color: #B45309; border: 1px solid #FCD34D; padding: 0 12px; margin-right: 8px; border-radius: 8px; font-weight: 600; font-size: 0.8rem; cursor: pointer; display: flex; align-items: center; gap: 4px; }
        button#injectBtn:hover { background: #FEF3C7; }

        .tab-content { display: none; opacity: 0; transition: opacity 0.4s ease; }
        .tab-content.active { display: block; opacity: 1; }
        .group-header { font-size: 0.9rem; font-weight: 800; color: rgba(0,0,0,0.4); text-transform: uppercase; letter-spacing: 0.05em; margin: 40px 0 15px 0; padding-bottom: 8px; border-bottom: 2px solid rgba(0,0,0,0.05); display: flex; align-items: center; gap: 10px; }
        .cards-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 20px; }
        .job-card { background: var(--surface); border-radius: 16px; box-shadow: 0 2px 4px 0 rgba(0,0,0,0.02); border: 1px solid rgba(0,0,0,0.05); padding: 20px; display: flex; flex-direction: column; gap: 15px; transition: all 0.2s; position: relative; overflow: hidden; cursor: pointer; }
        .job-card:hover { transform: translateY(-4px); box-shadow: 0 12px 20px -5px rgba(0,0,0,0.08); }
        .card-applied { border-top: 6px solid #2563EB; }
        .card-interview { border-top: 6px solid #F97316; }
        .card-offer { border-top: 6px solid #16A34A; }
        .card-rejected { border-top: 6px solid #EF4444; opacity: 0.85; }
        .card-content h3 { font-size: 1.1rem; font-weight: 700; color: var(--text-main); margin: 0 0 4px 0; line-height: 1.4; }
        .card-content p { font-size: 0.9rem; font-weight: 500; color: var(--text-sub); margin: 0; }
        .edit-icon-btn { position: absolute; top: 16px; right: 16px; width: 28px; height: 28px; border-radius: 6px; background: transparent; border: none; color: #9CA3AF; cursor: pointer; display: flex; align-items: center; justify-content: center; transition: all 0.2s; z-index: 5; }
        .edit-icon-btn:hover { background: #F3F4F6; color: var(--accent-black); }
        .card-footer { margin-top: auto; display: flex; justify-content: space-between; align-items: center; gap: 12px; border-top: 1px solid #F3F4F6; padding-top: 16px; }
        select.status-pill { padding: 6px 12px; border-radius: 20px; font-size: 0.75rem; font-weight: 600; border: none; cursor: pointer; appearance: none; text-align: center; transition: transform 0.1s; flex-shrink: 0; }
        select.status-pill:active { transform: scale(0.95); }
        .pill-blue { background: #EFF6FF; color: #1E40AF; }
        .pill-orange { background: #FFF7ED; color: #9A3412; }
        .pill-green { background: #F0FDF4; color: #166534; }
        .pill-red { background: #FEF2F2; color: #991B1B; }
        .view-job-link { font-size: 0.75rem; color: var(--blue-600); text-decoration: none; font-weight: 600; flex: 1; text-align: right; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
        .view-job-link:hover { text-decoration: underline; }
        
        /* Modals */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); backdrop-filter: blur(4px); z-index: 2000; display: none; justify-content: center; align-items: center; opacity: 0; transition: opacity 0.2s ease; }
        .modal-overlay.open { display: flex; opacity: 1; }
        .modal-box { background: #fff; border-radius: 20px; padding: 32px; width: 420px; box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.25); transform: scale(0.95); transition: transform 0.2s ease; }
        .modal-overlay.open .modal-box { transform: scale(1); }
        .modal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 24px; }
        .modal-title { font-size: 1.25rem; font-weight: 700; color: var(--accent-black); }
        .close-modal { background: none; border: none; font-size: 1.5rem; color: #9CA3AF; cursor: pointer; }
        .form-group { margin-bottom: 20px; }
        .form-label { display: block; font-size: 0.85rem; font-weight: 600; color: var(--text-sub); margin-bottom: 6px; }
        .form-input, textarea.form-input { width: 100%; padding: 10px 14px; border: 1px solid #E5E7EB; border-radius: 8px; font-size: 0.95rem; color: var(--text-main); transition: border 0.2s; font-family: inherit; }
        .form-input:focus { border-color: #2563EB; }
        .modal-actions { display: flex; justify-content: space-between; align-items: center; margin-top: 32px; }
        .btn-delete-full { color: #EF4444; background: #FEF2F2; border: none; padding: 10px 20px; border-radius: 8px; font-weight: 600; font-size: 0.9rem; cursor: pointer; }
        .btn-delete-full:hover { background: #FEE2E2; }
        .btn-group-right { display: flex; gap: 12px; }
        .btn-cancel { background: transparent; border: 1px solid #E5E7EB; padding: 10px 20px; border-radius: 8px; font-weight: 600; color: var(--text-main); cursor: pointer; }
        .btn-save { background: var(--accent-black); color: #fff; border: none; padding: 10px 24px; border-radius: 8px; font-weight: 600; cursor: pointer; }
        .btn-save:hover { opacity: 0.9; }

        /* PASSWORD SCREEN */
        #auth-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 9999; display: flex; flex-direction: column; align-items: center; justify-content: center; color: white; transition: transform 0.5s ease-in-out; }
        #auth-screen.unlocked { transform: translateY(-100%); }
        .auth-container { text-align: center; }
        .auth-input { background: #222; border: 1px solid #333; color: white; padding: 12px 20px; font-size: 1.2rem; border-radius: 12px; text-align: center; letter-spacing: 4px; margin-top: 20px; outline: none; transition: border 0.2s; }
        .auth-input:focus { border-color: #2563EB; }
        .auth-msg { color: #888; margin-top: 10px; font-size: 0.8rem; }

        #sync-status { position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%); background: #111; color: #fff; padding: 10px 20px; border-radius: 50px; font-size: 0.8rem; z-index: 5000; opacity: 0; transition: opacity 0.3s; pointer-events: none; }
        #sync-status.show { opacity: 1; }
    </style>
</head>
<body>

    <div id="auth-screen">
        <div class="auth-container">
            <h1>Job Tracker Locked</h1>
            <input type="password" id="pinInput" class="auth-input" placeholder="ENTER PIN" maxlength="4">
            <div class="auth-msg">Hint: 1234</div>
        </div>
    </div>

    <div id="sync-status">Syncing with Google Sheets...</div>

    <div class="modal-overlay" id="injectModal">
        <div class="modal-box">
            <div class="modal-header">
                <div class="modal-title">Inject Job Data</div>
                <button class="close-modal" onclick="closeInjectModal()">×</button>
            </div>
            <div class="form-group">
                <label class="form-label">Paste 3 Lines (Title, Company, Link)</label>
                <textarea id="injectText" class="form-input" rows="5" placeholder="Senior Engineer&#10;Google&#10;https://linkedin..."></textarea>
            </div>
            <div class="modal-actions">
                <button class="btn-cancel" onclick="closeInjectModal()">Cancel</button>
                <button class="btn-save" onclick="processInject()">Auto-Fill & Save</button>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="editModal">
        <div class="modal-box">
            <div class="modal-header">
                <div class="modal-title">Edit Job</div>
                <button class="close-modal" onclick="closeEditModal()">×</button>
            </div>
            <div class="form-group">
                <label class="form-label">Job Title</label>
                <input type="text" id="editTitle" class="form-input">
            </div>
            <div class="form-group">
                <label class="form-label">Company Name</label>
                <input type="text" id="editCompany" class="form-input">
            </div>
            <div class="form-group">
                <label class="form-label">Job Link</label>
                <input type="text" id="editLink" class="form-input">
            </div>
            <div class="modal-actions">
                <button class="btn-delete-full" onclick="deleteFromModal()">Delete</button>
                <div class="btn-group-right">
                    <button class="btn-cancel" onclick="closeEditModal()">Cancel</button>
                    <button class="btn-save" onclick="saveEdit()">Save Changes</button>
                </div>
            </div>
        </div>
    </div>

    <div class="top-controls">
        <span class="view-label">Group By:</span>
        <div class="toggle-switch" id="viewToggle" onclick="toggleViewMode()">
            <div class="toggle-slider"></div>
            <div class="toggle-option opt-month">Month</div>
            <div class="toggle-option opt-date">Day</div>
        </div>
    </div>

    <div class="nav-container">
        <nav class="pill-nav" id="mainNav">
            <div class="pill-slider" id="pillSlider"></div>
            <button class="nav-item active" onclick="switchTab('applied', this)">Applied <span class="badge" id="cnt-applied">0</span></button>
            <button class="nav-item" onclick="switchTab('interviews', this)">Interviews <span class="badge" id="cnt-interviews">0</span></button>
            <button class="nav-item" onclick="switchTab('offers', this)">Offers <span class="badge" id="cnt-offers">0</span></button>
            <button class="nav-item" onclick="switchTab('rejected', this)">Rejected <span class="badge" id="cnt-rejected">0</span></button>
        </nav>
    </div>

    <main>
        <div class="input-area">
            <div class="add-box">
                <button id="injectBtn" onclick="openInjectModal()">⚡ Inject</button>
                <input type="text" id="urlInput" placeholder="Paste LinkedIn Job URL..." autocomplete="off">
                <button id="addBtn">Track Job</button>
            </div>
        </div>

        <div id="tab-applied" class="tab-content active"></div>
        <div id="tab-interviews" class="tab-content"></div>
        <div id="tab-offers" class="tab-content"></div>
        <div id="tab-rejected" class="tab-content"></div>
    </main>

<script>
    // --- CONFIGURATION ---
    // !!! PASTE YOUR DEPLOYED GOOGLE APPS SCRIPT URL HERE !!!
    const APPS_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyNlyBkMR43Z2Lx8RVVnRYuEWINTtOASOJqOJ3PWUEKo7gyaPSbDCw8oB34XJ9iGtCl/exec"; 
    
    // CHANGE THIS TO SET YOUR PASSWORD
    const APP_PIN = "1234"; 

    let jobs = [];
    let currentTab = 'applied';
    let groupBy = 'month';
    let editingJobId = null;

    // --- AUTH LOGIC ---
    const pinInput = document.getElementById('pinInput');
    pinInput.focus();
    pinInput.addEventListener('keyup', (e) => {
        if(e.target.value === APP_PIN) {
            document.getElementById('auth-screen').classList.add('unlocked');
            // Wait for unlock animation, then fetch data
            setTimeout(fetchJobs, 500); 
        }
    });

    const CATEGORY_MAP = {
        'applied': 'applied',
        'intro': 'interviews', 'tech': 'interviews', 'takehome': 'interviews',
        'offer': 'offers',
        'rejected': 'rejected'
    };
    const BG_COLORS = { 'applied': '#EFF6FF', 'interviews': '#FFF7ED', 'offers': '#F0FDF4', 'rejected': '#FEF2F2' };
    const NAV_STYLES = {
        'applied':    { bg: 'rgba(37, 99, 235, 0.2)', text: '#1E40AF' },
        'interviews': { bg: 'rgba(249, 115, 22, 0.2)', text: '#9A3412' },
        'offers':     { bg: 'rgba(22, 163, 74, 0.2)', text: '#166534' },
        'rejected':   { bg: 'rgba(239, 68, 68, 0.2)', text: '#991B1B' }
    };

    // --- API CALLS (Apps Script) ---
    async function fetchJobs() {
        showSync(true);
        try {
            // Must use action=get
            const res = await fetch(`${APPS_SCRIPT_URL}?action=get`);
            const data = await res.json();
            jobs = data;
            renderTabs();
        } catch(e) { console.error("Sync failed", e); }
        showSync(false);
    }

    async function apiAddJob(title, company, link) {
        // Apps Script expects JSON body
        await fetch(`${APPS_SCRIPT_URL}?action=add`, {
            method: 'POST', 
            // Apps Script requires text/plain to avoid CORS preflight issues sometimes
            body: JSON.stringify({ title, company, link })
        });
    }

    async function apiUpdateJob(id, field, value) {
        let payload = { id: id };
        payload[field] = value;
        await fetch(`${APPS_SCRIPT_URL}?action=edit`, {
            method: 'POST', body: JSON.stringify(payload)
        });
    }

    async function apiEditFull(id, title, company, link) {
        await fetch(`${APPS_SCRIPT_URL}?action=edit`, {
            method: 'POST', body: JSON.stringify({ id, title, company, link })
        });
    }

    async function apiDeleteJob(id) {
        await fetch(`${APPS_SCRIPT_URL}?action=delete`, {
            method: 'POST', body: JSON.stringify({ id })
        });
    }

    // --- UI HELPERS ---
    function showSync(show) {
        const el = document.getElementById('sync-status');
        if(show) el.classList.add('show');
        else el.classList.remove('show');
    }
    
    // --- ACTIONS ---
    async function addJob() {
        const input = document.getElementById('urlInput');
        const btn = document.getElementById('addBtn');
        const url = input.value.trim();
        // Fallback defaults if just pasting a URL
        const title = "Unknown Role";
        const company = "Unknown Company";

        if (!url) return;
        btn.innerText = "Saving...";
        btn.disabled = true;

        try {
            // Optimistic Add
            const newJob = {
                id: Date.now(),
                date: new Date().toISOString(),
                company: company, title: title, status: 'applied', link: url
            };
            jobs.unshift(newJob);
            renderTabs();
            input.value = '';
            
            await apiAddJob(title, company, url);
            await fetchJobs(); // Sync real ID
        } catch (e) {
            alert("Error adding job.");
        } finally {
            btn.innerText = "Track Job";
            btn.disabled = false;
        }
    }

    // --- INJECT LOGIC ---
    function openInjectModal() { document.getElementById('injectModal').classList.add('open'); }
    function closeInjectModal() { document.getElementById('injectModal').classList.remove('open'); document.getElementById('injectText').value = ''; }
    
    async function processInject() {
        const text = document.getElementById('injectText').value.trim();
        if(!text) return;
        
        const lines = text.split('\n').map(l => l.trim()).filter(l => l.length > 0);
        const title = lines[0] || "Unknown Role";
        const company = lines[1] || "Unknown Company";
        const link = lines[2] || "";

        closeInjectModal();
        
        // Add Directly
        const newJob = {
            id: Date.now(),
            date: new Date().toISOString(),
            company: company, title: title, status: 'applied', link: link
        };
        jobs.unshift(newJob);
        renderTabs();
        
        showSync(true);
        await apiAddJob(title, company, link);
        await fetchJobs();
        showSync(false);
    }

    async function updateJobStatus(id, newStatus) {
        const job = jobs.find(j => j.id === id);
        if (job && job.status !== newStatus) {
            job.status = newStatus;
            job.date = new Date().toISOString(); // Update date locally
            renderTabs();
            await apiUpdateJob(id, 'status', newStatus);
        }
    }

    // --- EDIT MODAL ---
    function openEditModal(id) {
        const job = jobs.find(j => j.id === id);
        if(!job) return;
        editingJobId = id;
        document.getElementById('editTitle').value = job.title;
        document.getElementById('editCompany').value = job.company;
        document.getElementById('editLink').value = job.link;
        document.getElementById('editModal').classList.add('open');
    }
    function closeEditModal() { document.getElementById('editModal').classList.remove('open'); editingJobId = null; }

    async function saveEdit() {
        if(!editingJobId) return;
        const id = editingJobId;
        const t = document.getElementById('editTitle').value;
        const c = document.getElementById('editCompany').value;
        const l = document.getElementById('editLink').value;

        const job = jobs.find(j => j.id === id);
        if (job) { job.title = t; job.company = c; job.link = l; }
        renderTabs();
        closeEditModal();

        showSync(true);
        await apiEditFull(id, t, c, l);
        showSync(false);
    }

    async function deleteFromModal() {
        if(!editingJobId) return;
        if(confirm("Delete this job?")) {
            const id = editingJobId;
            jobs = jobs.filter(j => j.id !== id);
            renderTabs();
            closeEditModal();
            showSync(true);
            await apiDeleteJob(id);
            showSync(false);
        }
    }

    // --- RENDER LOGIC (Same as before) ---
    function movePillTo(element) {
        const slider = document.getElementById('pillSlider');
        slider.style.left = `${element.offsetLeft}px`;
        slider.style.width = `${element.offsetWidth}px`;
    }

    function switchTab(tabName, clickedBtn) {
        currentTab = tabName;
        const nav = document.getElementById('mainNav');
        const styles = NAV_STYLES[tabName];
        nav.style.setProperty('--nav-slider-bg', styles.bg);
        nav.style.setProperty('--nav-active-text', styles.text);
        document.querySelectorAll('.nav-item').forEach(b => b.classList.remove('active'));
        if(clickedBtn) clickedBtn.classList.add('active');
        if(clickedBtn) movePillTo(clickedBtn);
        document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
        document.getElementById(`tab-${tabName}`).classList.add('active');
        document.body.style.backgroundColor = BG_COLORS[tabName];
    }

    function toggleViewMode() {
        const toggle = document.getElementById('viewToggle');
        groupBy = (groupBy === 'month') ? 'date' : 'month';
        if(groupBy === 'date') toggle.classList.add('date-mode');
        else toggle.classList.remove('date-mode');
        renderTabs();
    }

    function getGroupKey(isoDate) {
        const date = new Date(isoDate);
        if (groupBy === 'month') return date.toLocaleString('default', { month: 'long', year: 'numeric' });
        // Day grouping logic similar to mobile
        const now = new Date();
        const today = new Date(now.getFullYear(), now.getMonth(), now.getDate());
        const jobDate = new Date(date.getFullYear(), date.getMonth(), date.getDate());
        if(jobDate.getTime() === today.getTime()) return "TODAY";
        return date.toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' });
    }

    function renderTabs() {
        const counts = { applied: 0, interviews: 0, offers: 0, rejected: 0 };
        ['applied', 'interviews', 'offers', 'rejected'].forEach(k => document.getElementById(`tab-${k}`).innerHTML = '');

        const grouped = { applied: {}, interviews: {}, offers: {}, rejected: {} };

        jobs.forEach(job => {
            const cat = CATEGORY_MAP[job.status] || 'applied';
            counts[cat]++;
            const key = getGroupKey(job.date);
            if (!grouped[cat][key]) grouped[cat][key] = [];
            grouped[cat][key].push(job);
        });

        document.getElementById('cnt-applied').innerText = counts.applied;
        document.getElementById('cnt-interviews').innerText = counts.interviews;
        document.getElementById('cnt-offers').innerText = counts.offers;
        document.getElementById('cnt-rejected').innerText = counts.rejected;

        Object.keys(grouped).forEach(cat => {
            const container = document.getElementById(`tab-${cat}`);
            Object.keys(grouped[cat]).forEach(key => {
                const header = document.createElement('div');
                header.className = 'group-header';
                header.innerText = key;
                container.appendChild(header);
                const grid = document.createElement('div');
                grid.className = 'cards-grid';
                grouped[cat][key].forEach(job => grid.appendChild(createCard(job, cat)));
                container.appendChild(grid);
            });
            if(Object.keys(grouped[cat]).length === 0) container.innerHTML = `<div style="text-align:center; padding:80px; color:rgba(0,0,0,0.3); font-style:italic;">No jobs yet.</div>`;
        });
    }

    function createCard(job, cat) {
        let borderClass = 'card-applied';
        let pillClass = 'pill-blue';
        if(cat === 'interviews') { borderClass = 'card-interview'; pillClass = 'pill-orange'; }
        if(cat === 'offers') { borderClass = 'card-offer'; pillClass = 'pill-green'; }
        if(cat === 'rejected') { borderClass = 'card-rejected'; pillClass = 'pill-red'; }

        const div = document.createElement('div');
        div.className = `job-card ${borderClass}`;
        
        // Remove click event on card itself, only clicking link opens link
        div.innerHTML = `
            <button class="edit-icon-btn" onclick="openEditModal(${job.id})">
                <svg width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z"></path></svg>
            </button>
            <div class="card-content">
                <h3>${job.title}</h3>
                <p>${job.company}</p>
            </div>
            <div class="card-footer">
                <select class="status-pill ${pillClass}" onchange="updateJobStatus(${job.id}, this.value)">
                    <option value="applied" ${job.status === 'applied' ? 'selected' : ''}>Applied</option>
                    <option value="intro" ${job.status === 'intro' ? 'selected' : ''}>Intro</option>
                    <option value="tech" ${job.status === 'tech' ? 'selected' : ''}>Tech</option>
                    <option value="takehome" ${job.status === 'takehome' ? 'selected' : ''}>Take Home</option>
                    <option value="offer" ${job.status === 'offer' ? 'selected' : ''}>Offer</option>
                    <option value="rejected" ${job.status === 'rejected' ? 'selected' : ''}>Rejected</option>
                </select>
                <a href="${job.link}" target="_blank" class="view-job-link">Click here to view job description</a>
            </div>
        `;
        return div;
    }

    window.addEventListener('resize', () => {
        const activeBtn = document.querySelector('.nav-item.active');
        if(activeBtn) movePillTo(activeBtn);
    });
    
    document.getElementById('addBtn').addEventListener('click', addJob);
    document.getElementById('urlInput').addEventListener('keypress', (e) => { if(e.key === 'Enter') addJob(); });
    
    // Initial Load - Check for active tab styling
    window.addEventListener('load', () => {
         const activeBtn = document.querySelector('.nav-item.active');
         if(activeBtn) switchTab('applied', activeBtn);
    });
</script>
</body>
</html>